<!-- standalone .html file; preliminary code for MSIT task -->
<!DOCTYPE html>
<html>
    <head>
        <title>Multi Source Interference Task</title>
        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-categorize-html.js"></script>
        <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        <style>
            .task { 
                font-size: 60px; 
            }
        </style>
    </head>
    <body>
    </body>
    <script>
        // number of times to run the experiment; number of tasks = 3*tests
        var tests = 3;

        // welcome and enable fullscreen mode
        var welcome = {
            type: 'fullscreen',
            fullscreen_mode: true,
            message: '<p>Welcome to the experiment. Please press the button below to begin.</p>',
        };

        // set up instructions block
        var instructions = {
          type: "html-keyboard-response",
          stimulus: "<p> In this task, you will see a set of three symbols. These symbols can be the number 1," +
            " 2, 3, or the letter X. Two of the symbols will be the same, and one will be different.</p>"+
            "<p> Your task is to press the number on your keyboard corresponding to the symbol which is <strong>different</strong>" +
            " from the other two.</p>" +
            "<p>During some trials, the position of the symbol which is different will match the position of" +
                " the button you must press: </p>" +
            "<p style = 'font-size: 150%'> 1 X X </p>" +
                "<p>(Here, you would press 1.)</p>" +
            "<p> During other trials, the position of the symbol which is different will <strong>not</strong> match the position of " +
                " the button you must press: </p>" +
            "<p style = 'font-size: 150%'> 2 3 3 </p>" +
            "<p>(Here, you would press 2.)</p>" +
            "<p>Each trial will be followed by fixation on a black cross." +
            "<p> The following page is a test to check your understanding of the instructions.</p>" +
            "<p>Press any key to continue.</p>",
          post_trial_gap: 1000,
        };

        // symbols that can be used in each trial
        var symbols = [1, 2, 3];
        
        // stimuli for each test:
        // task (symbols), task_type(control, incongruent, congruent), correct(1,2,3) 
        var test_stimuli = [
            // tasks where answer is 1
            {task: symbols[0] + ' X X', data: {task_type: 'control', correct_response: '1'} },
            {task: symbols[0] + ' 2 2', data: {task_type: 'congruent', correct_response: '1'} },
            {task: symbols[0] + ' 3 3', data: {task_type: 'congruent', correct_response: '1'} },
            {task: '2 ' + symbols[0] + ' 2', data: {task_type: 'incongruent', correct_response: '1'} },
            {task: '3 ' + symbols[0] + ' 3', data: {task_type: 'incongruent', correct_response: '1'} },
            {task: '2 2 ' + symbols[0], data: {task_type: 'incongruent', correct_response: '1'} },
            {task: '3 3 ' + symbols[0], data: {task_type: 'incongruent', correct_response: '1'} },

            // tasks where answer is 2
            {task: 'X ' + symbols[1] + ' X', data: {task_type: 'control', correct_response: '2'} },
            {task: '1 ' + symbols[1] + ' 1', data: {task_type: 'congruent', correct_response: '2'} },
            {task: '3 ' + symbols[1] + ' 3', data: {task_type: 'congruent', correct_response: '2'} },
            {task: '1 1 ' + symbols[1], data: {task_type: 'incongruent', correct_response: '2'} },
            {task: '3 3 ' + symbols[1], data: {task_type: 'incongruent', correct_response: '2'} },
            {task: symbols[1] + ' 1 1', data: {task_type: 'incongruent', correct_response: '2'} },
            {task: symbols[1] + ' 3 3', data: {task_type: 'incongruent', correct_response: '2'} },

            // tasks where answer is 3
            {task: 'X X ' + symbols[2], data: {task_type: 'control', correct_response: '3'} },
            {task: '1 1 ' + symbols[2], data: {task_type: 'congruent', correct_response: '3'} },
            {task: '2 2 ' + symbols[2], data: {task_type: 'congruent', correct_response: '3'} },
            {task: symbols[2] + ' 1 1', data: {task_type: 'incongruent', correct_response: '3'} },
            {task: symbols[2] + ' 2 2', data: {task_type: 'incongruent', correct_response: '3'} },
            {task: '1 ' + symbols[2] + ' 1', data: {task_type: 'incongruent', correct_response: '3'} },
            {task: '2 ' + symbols[2] + ' 2', data: {task_type: 'incongruent', correct_response: '3'} },
    ];

        // in between trials + 
        var fixation = { // do not need to push b/c in test_procedure timeline
            type: 'html-keyboard-response',
            stimulus: '<div style="font-size:60px;">+</div>',
            choices: jsPsych.NO_KEYS, // no user inputs accepted
            // create function to randomize trial duration      
            trial_duration: function(){
                // [0] to get the value in the array
                return jsPsych.randomization.sampleWithoutReplacement([250, 500, 750, 1000, 1250, 1500, 1750, 2000], 1)[0];
            },
            data: {task_type: 'fixation'},
        }


        // show test stimulus; do not need to push b/c in test_procedure timeline
        var test = { 
            type: "html-keyboard-response",
            stimulus: function(){ 
                return "<p class='task'>"+jsPsych.timelineVariable('task', true)+"</p>"; 
            },
            choices: ['1','2','3'],
            data: jsPsych.timelineVariable('data'),
            on_finish: function(data){
                data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
            },
        }

        // link timeline variables to method .timelineVariable()
        var test_procedure = {
            timeline: [test, fixation], // create new timeline
            timeline_variables: test_stimuli, // set the timeline_variables property
            // --> runs test_procedure for each test variable 
            // fixation, test, stimulus 1, fixation, test, stimulus 2
            sample: {
                type: 'alternate-groups',
                groups: [[0,7,14],[1,2,8,9,15,16],[3,4,5,6,10,11,12,13,17,18,19,20]], // group 1 = controls, group 2 = incongruent, group 3 = congruent
                randomize_group_order: true,
                size: tests, // # of times tests run
            }
        }
        
        // user results
        var debrief_block = {
            type: "html-keyboard-response",
            stimulus: function() {
                // filter data into categories
                var control_data = jsPsych.data.get().filter({task_type: 'control'}); // get control trials data
                var congruent_data = jsPsych.data.get().filter({task_type: 'congruent'}); // get congruent trials data
                var incongruent_data = jsPsych.data.get().filter({task_type: 'incongruent'}); // get incongruent trials data

                // get number of correct trials per category
                var correct_control = control_data.filter({correct: true});
                var correct_congruent = congruent_data.filter({correct: true});
                var correct_incongruent = incongruent_data.filter({correct: true});

                // calculate accuracy
                var accuracy_control = Math.round(correct_control.count() / control_data.count() * 100); 
                var accuracy_congruent = Math.round(correct_congruent.count() / congruent_data.count() * 100); 
                var accuracy_incongruent = Math.round(correct_incongruent.count() / incongruent_data.count() * 100); 

                // get reaction times
                var rt_control = Math.round(correct_control.select('rt').mean());
                var rt_congruent = Math.round(correct_congruent.select('rt').mean());
                var rt_incongruent = Math.round(correct_incongruent.select('rt').mean());

                return "<p><strong>Control data:</strong></p>"+
                    "<p>Accuracy: " + accuracy_control + "%</p>"+
                    "<p>Average reaction time: " + rt_control + "ms.</p>"+

                    "<br></br>" +
                    "<p><strong>Congruent tasks data:</strong></p>"+
                    "<p>Accuracy: " + accuracy_congruent + "%</p>"+
                    "<p>Average reaction time: " + rt_congruent + "ms.</p>"+

                    "<br></br>" +
                    "<p><strong>Incongruent tasks data:</strong></p>"+
                    "<p>Accuracy: " + accuracy_incongruent + "%</p>"+
                    "<p>Average reaction time: " + rt_incongruent + "ms.</p>"+

                    "<br></br>" +
                    "<p>Press any key to complete the experiment. Thank you!</p>";
            }
        };
        
        //  set up experiment structure
        var timeline = [];
        timeline.push(welcome);
        timeline.push(instructions);
        timeline.push(test_procedure);
        timeline.push(debrief_block);
        
        // start experiment
        jsPsych.init({
            timeline: timeline,
            on_finish: function() {
                jsPsych.data.displayData();
            }
        });
    </script>
</html>
